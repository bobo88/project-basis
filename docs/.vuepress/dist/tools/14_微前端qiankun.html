<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微前端「qiankun」的实践 | 袁波</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta name="description" content="技术清单文档">
    
    <link rel="preload" href="/assets/css/0.styles.bf4d7f2a.css" as="style"><link rel="preload" href="/assets/js/app.51b826ab.js" as="script"><link rel="preload" href="/assets/js/2.ebacbe49.js" as="script"><link rel="preload" href="/assets/js/5.13e02d4e.js" as="script"><link rel="prefetch" href="/assets/js/10.84061fa5.js"><link rel="prefetch" href="/assets/js/100.3241a12f.js"><link rel="prefetch" href="/assets/js/101.2e932882.js"><link rel="prefetch" href="/assets/js/102.0ee7f566.js"><link rel="prefetch" href="/assets/js/103.cac1ce02.js"><link rel="prefetch" href="/assets/js/104.c816734b.js"><link rel="prefetch" href="/assets/js/105.2a7d1979.js"><link rel="prefetch" href="/assets/js/106.83811f28.js"><link rel="prefetch" href="/assets/js/107.e144d08a.js"><link rel="prefetch" href="/assets/js/108.1465332b.js"><link rel="prefetch" href="/assets/js/109.061fa458.js"><link rel="prefetch" href="/assets/js/11.8273419e.js"><link rel="prefetch" href="/assets/js/110.48881727.js"><link rel="prefetch" href="/assets/js/111.331a11ac.js"><link rel="prefetch" href="/assets/js/112.9d3f29ae.js"><link rel="prefetch" href="/assets/js/113.74b0c14c.js"><link rel="prefetch" href="/assets/js/114.0fb8004c.js"><link rel="prefetch" href="/assets/js/115.20302b4c.js"><link rel="prefetch" href="/assets/js/116.33b2edbe.js"><link rel="prefetch" href="/assets/js/117.dc474569.js"><link rel="prefetch" href="/assets/js/118.8bbb2451.js"><link rel="prefetch" href="/assets/js/119.3d1f4820.js"><link rel="prefetch" href="/assets/js/12.aa2b56b1.js"><link rel="prefetch" href="/assets/js/120.e78ce872.js"><link rel="prefetch" href="/assets/js/121.0afe4d85.js"><link rel="prefetch" href="/assets/js/122.aee94a2f.js"><link rel="prefetch" href="/assets/js/123.b9d9ec1a.js"><link rel="prefetch" href="/assets/js/124.b648c552.js"><link rel="prefetch" href="/assets/js/125.159e2705.js"><link rel="prefetch" href="/assets/js/126.ac40a1a6.js"><link rel="prefetch" href="/assets/js/127.cf0b7817.js"><link rel="prefetch" href="/assets/js/128.39aa9ea9.js"><link rel="prefetch" href="/assets/js/129.708ab809.js"><link rel="prefetch" href="/assets/js/13.d11f3390.js"><link rel="prefetch" href="/assets/js/130.c4130564.js"><link rel="prefetch" href="/assets/js/131.77608061.js"><link rel="prefetch" href="/assets/js/132.723ef754.js"><link rel="prefetch" href="/assets/js/133.29e00d1d.js"><link rel="prefetch" href="/assets/js/134.f2440244.js"><link rel="prefetch" href="/assets/js/135.5cf0d8ff.js"><link rel="prefetch" href="/assets/js/136.a1125e7b.js"><link rel="prefetch" href="/assets/js/137.863094c1.js"><link rel="prefetch" href="/assets/js/138.07266cdd.js"><link rel="prefetch" href="/assets/js/139.09cc52dc.js"><link rel="prefetch" href="/assets/js/14.4b688902.js"><link rel="prefetch" href="/assets/js/140.3a579eee.js"><link rel="prefetch" href="/assets/js/141.8ddffa64.js"><link rel="prefetch" href="/assets/js/142.245b0cb8.js"><link rel="prefetch" href="/assets/js/143.7860e4c5.js"><link rel="prefetch" href="/assets/js/144.324f2bb3.js"><link rel="prefetch" href="/assets/js/145.9aa7f64d.js"><link rel="prefetch" href="/assets/js/146.b6c0f8a5.js"><link rel="prefetch" href="/assets/js/147.3800dacb.js"><link rel="prefetch" href="/assets/js/148.c05d1a92.js"><link rel="prefetch" href="/assets/js/149.dc6e7be8.js"><link rel="prefetch" href="/assets/js/15.236e5c45.js"><link rel="prefetch" href="/assets/js/150.9fb7b967.js"><link rel="prefetch" href="/assets/js/151.9ffbee91.js"><link rel="prefetch" href="/assets/js/152.abb6c9da.js"><link rel="prefetch" href="/assets/js/153.da0ae3dd.js"><link rel="prefetch" href="/assets/js/154.c82f868f.js"><link rel="prefetch" href="/assets/js/155.1a8b18f8.js"><link rel="prefetch" href="/assets/js/156.31721a78.js"><link rel="prefetch" href="/assets/js/157.bc756a10.js"><link rel="prefetch" href="/assets/js/158.b1b5d27c.js"><link rel="prefetch" href="/assets/js/159.0d632abc.js"><link rel="prefetch" href="/assets/js/16.df9b4044.js"><link rel="prefetch" href="/assets/js/160.8aa62bad.js"><link rel="prefetch" href="/assets/js/161.939cfb76.js"><link rel="prefetch" href="/assets/js/162.555f62d7.js"><link rel="prefetch" href="/assets/js/163.a7eed12b.js"><link rel="prefetch" href="/assets/js/164.40886010.js"><link rel="prefetch" href="/assets/js/165.64888cb7.js"><link rel="prefetch" href="/assets/js/166.8e64a450.js"><link rel="prefetch" href="/assets/js/167.4bc2748e.js"><link rel="prefetch" href="/assets/js/168.8659f413.js"><link rel="prefetch" href="/assets/js/169.aa227b08.js"><link rel="prefetch" href="/assets/js/17.4e741bef.js"><link rel="prefetch" href="/assets/js/170.c6de4caf.js"><link rel="prefetch" href="/assets/js/171.419f1920.js"><link rel="prefetch" href="/assets/js/172.d6356edb.js"><link rel="prefetch" href="/assets/js/173.339d0ccd.js"><link rel="prefetch" href="/assets/js/174.8098141b.js"><link rel="prefetch" href="/assets/js/175.d7a08ecb.js"><link rel="prefetch" href="/assets/js/176.901919eb.js"><link rel="prefetch" href="/assets/js/177.0116de95.js"><link rel="prefetch" href="/assets/js/178.cca768c9.js"><link rel="prefetch" href="/assets/js/179.eb41a01f.js"><link rel="prefetch" href="/assets/js/18.78c11bf5.js"><link rel="prefetch" href="/assets/js/180.19610dc4.js"><link rel="prefetch" href="/assets/js/181.a3cb2b2b.js"><link rel="prefetch" href="/assets/js/182.581722a3.js"><link rel="prefetch" href="/assets/js/183.02bc38cc.js"><link rel="prefetch" href="/assets/js/184.d768476c.js"><link rel="prefetch" href="/assets/js/185.236a080b.js"><link rel="prefetch" href="/assets/js/186.47e372ea.js"><link rel="prefetch" href="/assets/js/187.9b0f8422.js"><link rel="prefetch" href="/assets/js/188.6b44b80e.js"><link rel="prefetch" href="/assets/js/189.f8fb0e91.js"><link rel="prefetch" href="/assets/js/19.e2860783.js"><link rel="prefetch" href="/assets/js/190.3c94608d.js"><link rel="prefetch" href="/assets/js/191.740672dc.js"><link rel="prefetch" href="/assets/js/192.f93f3c10.js"><link rel="prefetch" href="/assets/js/193.7b261d5a.js"><link rel="prefetch" href="/assets/js/194.415e5023.js"><link rel="prefetch" href="/assets/js/195.001e1cb3.js"><link rel="prefetch" href="/assets/js/196.393c89f4.js"><link rel="prefetch" href="/assets/js/197.1b638b7f.js"><link rel="prefetch" href="/assets/js/198.d66ee6b9.js"><link rel="prefetch" href="/assets/js/199.7dc5b5f4.js"><link rel="prefetch" href="/assets/js/20.e60a5573.js"><link rel="prefetch" href="/assets/js/200.4134d9da.js"><link rel="prefetch" href="/assets/js/201.46dded0b.js"><link rel="prefetch" href="/assets/js/202.5c0ebe47.js"><link rel="prefetch" href="/assets/js/203.70ceb008.js"><link rel="prefetch" href="/assets/js/204.28795687.js"><link rel="prefetch" href="/assets/js/205.1a46ed56.js"><link rel="prefetch" href="/assets/js/206.ae533dbe.js"><link rel="prefetch" href="/assets/js/207.b01e1fa0.js"><link rel="prefetch" href="/assets/js/208.a3284897.js"><link rel="prefetch" href="/assets/js/209.e354e0a9.js"><link rel="prefetch" href="/assets/js/21.50293a16.js"><link rel="prefetch" href="/assets/js/210.98ab17f5.js"><link rel="prefetch" href="/assets/js/211.981c5c0c.js"><link rel="prefetch" href="/assets/js/212.226fc1c0.js"><link rel="prefetch" href="/assets/js/213.6ca2a93f.js"><link rel="prefetch" href="/assets/js/214.9e3c231f.js"><link rel="prefetch" href="/assets/js/215.765f1b50.js"><link rel="prefetch" href="/assets/js/216.ac5f46b0.js"><link rel="prefetch" href="/assets/js/217.ec30cb22.js"><link rel="prefetch" href="/assets/js/218.dcf5b901.js"><link rel="prefetch" href="/assets/js/219.bf6d68ab.js"><link rel="prefetch" href="/assets/js/22.949ff5cc.js"><link rel="prefetch" href="/assets/js/220.1930477f.js"><link rel="prefetch" href="/assets/js/221.f5c137e6.js"><link rel="prefetch" href="/assets/js/222.8bcfd028.js"><link rel="prefetch" href="/assets/js/223.6088b7d1.js"><link rel="prefetch" href="/assets/js/224.599f8236.js"><link rel="prefetch" href="/assets/js/225.3fd12e91.js"><link rel="prefetch" href="/assets/js/226.4011cde6.js"><link rel="prefetch" href="/assets/js/227.8c1bcbf6.js"><link rel="prefetch" href="/assets/js/228.472e3663.js"><link rel="prefetch" href="/assets/js/229.d7ede4c2.js"><link rel="prefetch" href="/assets/js/23.89ff4bd2.js"><link rel="prefetch" href="/assets/js/230.796834cb.js"><link rel="prefetch" href="/assets/js/231.d1beeec7.js"><link rel="prefetch" href="/assets/js/232.453795ee.js"><link rel="prefetch" href="/assets/js/233.d3eaba7e.js"><link rel="prefetch" href="/assets/js/234.ca40fed4.js"><link rel="prefetch" href="/assets/js/235.8086ca71.js"><link rel="prefetch" href="/assets/js/236.039ddce5.js"><link rel="prefetch" href="/assets/js/237.f40162da.js"><link rel="prefetch" href="/assets/js/238.427610d9.js"><link rel="prefetch" href="/assets/js/239.a3c4cd2f.js"><link rel="prefetch" href="/assets/js/24.cbb4194b.js"><link rel="prefetch" href="/assets/js/240.c6ec6551.js"><link rel="prefetch" href="/assets/js/241.cde2572d.js"><link rel="prefetch" href="/assets/js/242.8802bd19.js"><link rel="prefetch" href="/assets/js/243.3bb14df3.js"><link rel="prefetch" href="/assets/js/244.61ccdc55.js"><link rel="prefetch" href="/assets/js/245.c87a2472.js"><link rel="prefetch" href="/assets/js/246.d8dc10b1.js"><link rel="prefetch" href="/assets/js/247.928c34a7.js"><link rel="prefetch" href="/assets/js/248.3b0c6fa7.js"><link rel="prefetch" href="/assets/js/249.08390edf.js"><link rel="prefetch" href="/assets/js/25.8a8db335.js"><link rel="prefetch" href="/assets/js/250.a46d69f6.js"><link rel="prefetch" href="/assets/js/251.8d9fb8af.js"><link rel="prefetch" href="/assets/js/252.e61822ac.js"><link rel="prefetch" href="/assets/js/253.3af0d953.js"><link rel="prefetch" href="/assets/js/254.974bfc28.js"><link rel="prefetch" href="/assets/js/255.e065ba4d.js"><link rel="prefetch" href="/assets/js/256.00bf7454.js"><link rel="prefetch" href="/assets/js/257.a571654f.js"><link rel="prefetch" href="/assets/js/258.6da61938.js"><link rel="prefetch" href="/assets/js/259.9cdf31b5.js"><link rel="prefetch" href="/assets/js/26.d7fbeac8.js"><link rel="prefetch" href="/assets/js/260.04c26010.js"><link rel="prefetch" href="/assets/js/27.9312d6cc.js"><link rel="prefetch" href="/assets/js/28.30408298.js"><link rel="prefetch" href="/assets/js/29.c5d1a732.js"><link rel="prefetch" href="/assets/js/3.9c321d8c.js"><link rel="prefetch" href="/assets/js/30.faa51e29.js"><link rel="prefetch" href="/assets/js/31.a4163503.js"><link rel="prefetch" href="/assets/js/32.008dbb68.js"><link rel="prefetch" href="/assets/js/33.2579c1b7.js"><link rel="prefetch" href="/assets/js/34.8732e531.js"><link rel="prefetch" href="/assets/js/35.9f177807.js"><link rel="prefetch" href="/assets/js/36.20b46d8b.js"><link rel="prefetch" href="/assets/js/37.17ecdfc9.js"><link rel="prefetch" href="/assets/js/38.b02ffb56.js"><link rel="prefetch" href="/assets/js/39.eeabfa79.js"><link rel="prefetch" href="/assets/js/4.8ead8425.js"><link rel="prefetch" href="/assets/js/40.44ad1259.js"><link rel="prefetch" href="/assets/js/41.7494fbaf.js"><link rel="prefetch" href="/assets/js/42.ecd36a44.js"><link rel="prefetch" href="/assets/js/43.7d410474.js"><link rel="prefetch" href="/assets/js/44.48f4151c.js"><link rel="prefetch" href="/assets/js/45.f84a52c8.js"><link rel="prefetch" href="/assets/js/46.e8d11ad2.js"><link rel="prefetch" href="/assets/js/47.a9313801.js"><link rel="prefetch" href="/assets/js/48.57c923b0.js"><link rel="prefetch" href="/assets/js/49.d4da452c.js"><link rel="prefetch" href="/assets/js/50.4824888d.js"><link rel="prefetch" href="/assets/js/51.e7ced8e0.js"><link rel="prefetch" href="/assets/js/52.9ce69b46.js"><link rel="prefetch" href="/assets/js/53.29b81ce9.js"><link rel="prefetch" href="/assets/js/54.12fbcf3f.js"><link rel="prefetch" href="/assets/js/55.4c4042af.js"><link rel="prefetch" href="/assets/js/56.af4a81b7.js"><link rel="prefetch" href="/assets/js/57.322c7455.js"><link rel="prefetch" href="/assets/js/58.03fe6a05.js"><link rel="prefetch" href="/assets/js/59.039a4826.js"><link rel="prefetch" href="/assets/js/6.651ccfa8.js"><link rel="prefetch" href="/assets/js/60.192a0c68.js"><link rel="prefetch" href="/assets/js/61.c0d90207.js"><link rel="prefetch" href="/assets/js/62.935bb832.js"><link rel="prefetch" href="/assets/js/63.3bd705ac.js"><link rel="prefetch" href="/assets/js/64.55cac1c3.js"><link rel="prefetch" href="/assets/js/65.9d592ed2.js"><link rel="prefetch" href="/assets/js/66.040194c8.js"><link rel="prefetch" href="/assets/js/67.832687b9.js"><link rel="prefetch" href="/assets/js/68.32bdd67f.js"><link rel="prefetch" href="/assets/js/69.47f4ece7.js"><link rel="prefetch" href="/assets/js/7.2104e9f3.js"><link rel="prefetch" href="/assets/js/70.bc0ad96e.js"><link rel="prefetch" href="/assets/js/71.e82ff365.js"><link rel="prefetch" href="/assets/js/72.404519ef.js"><link rel="prefetch" href="/assets/js/73.994b54bd.js"><link rel="prefetch" href="/assets/js/74.7a2b0293.js"><link rel="prefetch" href="/assets/js/75.8dca015a.js"><link rel="prefetch" href="/assets/js/76.862887c6.js"><link rel="prefetch" href="/assets/js/77.3f2c62b9.js"><link rel="prefetch" href="/assets/js/78.83afedb7.js"><link rel="prefetch" href="/assets/js/79.605dd08c.js"><link rel="prefetch" href="/assets/js/8.549e1d45.js"><link rel="prefetch" href="/assets/js/80.f4312fc1.js"><link rel="prefetch" href="/assets/js/81.234e0d5e.js"><link rel="prefetch" href="/assets/js/82.a791150e.js"><link rel="prefetch" href="/assets/js/83.1d363593.js"><link rel="prefetch" href="/assets/js/84.32b7587a.js"><link rel="prefetch" href="/assets/js/85.e034dbeb.js"><link rel="prefetch" href="/assets/js/86.174977cf.js"><link rel="prefetch" href="/assets/js/87.2b626730.js"><link rel="prefetch" href="/assets/js/88.ef735fa7.js"><link rel="prefetch" href="/assets/js/89.ee38632a.js"><link rel="prefetch" href="/assets/js/9.52994faa.js"><link rel="prefetch" href="/assets/js/90.c48d01b9.js"><link rel="prefetch" href="/assets/js/91.2ceb1291.js"><link rel="prefetch" href="/assets/js/92.e3547aea.js"><link rel="prefetch" href="/assets/js/93.c50ba4a4.js"><link rel="prefetch" href="/assets/js/94.8f69e517.js"><link rel="prefetch" href="/assets/js/95.ebeb202a.js"><link rel="prefetch" href="/assets/js/96.049d4b17.js"><link rel="prefetch" href="/assets/js/97.e5c8d0b2.js"><link rel="prefetch" href="/assets/js/98.8e67b48c.js"><link rel="prefetch" href="/assets/js/99.7c7f37bb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bf4d7f2a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">袁波</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  前端工程化
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架系" class="dropdown-title"><span class="title">前端框架系</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端框架系" class="mobile-dropdown-title"><span class="title">前端框架系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  VUE 系列
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  React 系列
</a></li><li class="dropdown-item"><!----> <a href="/ts/" class="nav-link">
  Typescript 系列
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node 系列
</a></li><li class="dropdown-item"><!----> <a href="/mp/" class="nav-link">
  小程序 系列
</a></li><li class="dropdown-item"><!----> <a href="/leetcode/" class="nav-link">
  算法Leetcode
</a></li></ul></div></div><div class="nav-item"><a href="/tech-list/" class="nav-link">
  技术清单
</a></div><div class="nav-item"><a href="http://ycy88.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  园博吧
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  前端工程化
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架系" class="dropdown-title"><span class="title">前端框架系</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端框架系" class="mobile-dropdown-title"><span class="title">前端框架系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  VUE 系列
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  React 系列
</a></li><li class="dropdown-item"><!----> <a href="/ts/" class="nav-link">
  Typescript 系列
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node 系列
</a></li><li class="dropdown-item"><!----> <a href="/mp/" class="nav-link">
  小程序 系列
</a></li><li class="dropdown-item"><!----> <a href="/leetcode/" class="nav-link">
  算法Leetcode
</a></li></ul></div></div><div class="nav-item"><a href="/tech-list/" class="nav-link">
  技术清单
</a></div><div class="nav-item"><a href="http://ycy88.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  园博吧
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/tools/" class="sidebar-heading clickable router-link-active open"><span>前端工程化</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tools/1_Gulp.html" class="sidebar-link">Gulp</a></li><li><a href="/tools/2_Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/tools/3_Vite.html" class="sidebar-link">Vite</a></li><li><a href="/tools/4_Rollup.html" class="sidebar-link">Rollup</a></li><li><a href="/tools/5_nvm.html" class="sidebar-link">nvm</a></li><li><a href="/tools/6_PM2.html" class="sidebar-link">PM2</a></li><li><a href="/tools/7_nodemon.html" class="sidebar-link">nodemon</a></li><li><a href="/tools/8_Sass&amp;Less.html" class="sidebar-link">Sass&amp;Less</a></li><li><a href="/tools/9_Nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/tools/10_Monorepo.html" class="sidebar-link">Monorepo</a></li><li><a href="/tools/11_前端开发规范.html" class="sidebar-link">前端开发规范</a></li><li><a href="/tools/12_Git团队协作流程.html" class="sidebar-link">Git团队协作流程</a></li><li><a href="/tools/13_自动化部署.html" class="sidebar-link">自动化部署</a></li><li><a href="/tools/14_微前端.html" class="sidebar-link">微前端</a></li><li><a href="/tools/14_微前端qiankun.html" class="active sidebar-link">微前端qiankun</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tools/14_微前端qiankun.html#微前端「qiankun」的实践" class="sidebar-link">微前端「qiankun」的实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tools/14_微前端qiankun.html#一、安装" class="sidebar-link">一、安装</a></li><li class="sidebar-sub-header"><a href="/tools/14_微前端qiankun.html#二、使用" class="sidebar-link">二、使用</a></li><li class="sidebar-sub-header"><a href="/tools/14_微前端qiankun.html#三、项目实践" class="sidebar-link">三、项目实践</a></li><li class="sidebar-sub-header"><a href="/tools/14_微前端qiankun.html#四、demo验证" class="sidebar-link">四、DEMO验证</a></li></ul></li></ul></li><li><a href="/tools/14_微前端webpack 5 Module Federation.html" class="sidebar-link">微前端webpack 5 Module Federation</a></li><li><a href="/tools/15_BFF概念.html" class="sidebar-link">BFF概念</a></li><li><a href="/tools/16_单元测试.html" class="sidebar-link">单元测试</a></li><li><a href="/tools/17_阿里云服务器配置https.html" class="sidebar-link">阿里云服务器配置https</a></li><li><a href="/tools/18_HTTP简述.html" class="sidebar-link">HTTP简述</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="微前端「qiankun」的实践"><a href="#微前端「qiankun」的实践" class="header-anchor">#</a> 微前端「qiankun」的实践</h2> <div class="custom-block tip"><p class="custom-block-title">qiankun</p> <p>一种比较完善的微前端解决方案，使用简单，兼容任意JS框架。</p> <p>功能完备，几乎包含所有构建微前端系统时所需要的基本能力，如 样式隔离、js 沙箱、预加载等。</p></div> <p>qiankun 是一个基于 single-spa 的微前端实现库，旨在帮助大家能更简单、无痛的构建一个生产可用微前端架构系统。</p> <h3 id="一、安装"><a href="#一、安装" class="header-anchor">#</a> 一、安装</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$ yarn add qiankun  <span class="token comment">// or npm i qiankun -S</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="二、使用"><a href="#二、使用" class="header-anchor">#</a> 二、使用</h3> <h4 id="主应用"><a href="#主应用" class="header-anchor">#</a> 主应用</h4> <p>在主应用中注册微应用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> registerMicroApps<span class="token punctuation">,</span> start <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'qiankun'</span><span class="token punctuation">;</span>

<span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'react app'</span><span class="token punctuation">,</span> <span class="token comment">// app name registered</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'//localhost:7100'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">'#yourContainer'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">activeRule</span><span class="token operator">:</span> <span class="token string">'/yourActiveRule'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'vue app'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">scripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'//localhost:7100/main.js'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">'#yourContainer2'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">activeRule</span><span class="token operator">:</span> <span class="token string">'/yourActiveRule2'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>当微应用信息注册完之后，一旦浏览器的 url 发生变化，便会自动触发 qiankun 的匹配逻辑，所有 activeRule 规则匹配上的微应用就会被插入到指定的 container 中，同时依次调用微应用暴露出的生命周期钩子。</p> <p>如果微应用不是直接跟路由关联的时候，你也可以选择手动加载微应用的方式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> loadMicroApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'qiankun'</span><span class="token punctuation">;</span>

<span class="token function">loadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'//localhost:7100'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">'#yourContainer'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="微应用"><a href="#微应用" class="header-anchor">#</a> 微应用</h4> <p>微应用不需要额外安装任何其他依赖即可接入 qiankun 主应用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 导出相应的生命周期钩子</span>
<span class="token comment">// 微应用需要在自己的入口 js (通常就是你配置的 webpack 的 entry js) 导出 bootstrap、mount、unmount 三个生命周期钩子，以供主应用在适当的时机调用。</span>
<span class="token comment">/**
 * bootstrap 只会在微应用初始化的时候调用一次，下次微应用重新进入时会直接调用 mount 钩子，不会再重复触发 bootstrap。
 * 通常我们可以在这里做一些全局变量的初始化，比如不会在 unmount 阶段被销毁的应用级别的缓存等。
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react app bootstraped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 应用每次进入都会调用 mount 方法，通常我们在这里触发应用的渲染方法
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>container <span class="token operator">?</span> props<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 应用每次 切出/卸载 会调用的方法，通常在这里我们会卸载微应用的应用实例
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span>
    props<span class="token punctuation">.</span>container <span class="token operator">?</span> props<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 可选生命周期钩子，仅使用 loadMicroApp 方式加载微应用时生效
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update props'</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 配置微应用的打包工具</span>
<span class="token comment">// 除了代码中暴露出相应的生命周期钩子之外，为了让主应用能正确识别微应用暴露出来的一些信息，微应用的打包工具需要增加如下配置：</span>
<span class="token comment">// webpack</span>
<span class="token keyword">const</span> packageName <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">jsonpFunction</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="三、项目实践"><a href="#三、项目实践" class="header-anchor">#</a> 三、项目实践</h3> <h4 id="步骤一-首先-新建-qiankun-project-文件夹目录"><a href="#步骤一-首先-新建-qiankun-project-文件夹目录" class="header-anchor">#</a> 步骤一：首先，新建 qiankun-project 文件夹目录</h4> <h4 id="步骤二-初始化「基座项目」并配置"><a href="#步骤二-初始化「基座项目」并配置" class="header-anchor">#</a> 步骤二：初始化「基座项目」并配置</h4> <ul><li>2.1 在 qiankun-project 目录下，运行下面命令</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$ vue create micro<span class="token operator">-</span>main         <span class="token comment">// 生成一个 基座项目（VUE 3.x版本）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>2.2 配置「基座项目」：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 基座配置 1: micro-main/vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">lintOnSave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 关闭eslint检测</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span> <span class="token comment">// 这里的端口是必须和父应用配置的子应用端口一致</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 因为qiankun内部请求都是fetch来请求资源，所以子应用必须允许跨域</span>
      <span class="token string-property property">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 资源打包路径</span>
      <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">'vueApp'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">'umd'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 基座配置 2: micro-main/src/main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&quot;./router&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> registerMicroApps<span class="token punctuation">,</span> start <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'qiankun'</span><span class="token punctuation">;</span>

<span class="token comment">// 在主应用中注册子应用</span>
<span class="token function">registerMicroApps</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'vueApp'</span><span class="token punctuation">,</span>             <span class="token comment">// 微应用的名称 要求唯一。有多个地方需要使用到它</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'//localhost:8081'</span><span class="token punctuation">,</span>  <span class="token comment">// 通俗理解就是（微应用的访问地址）</span>
    <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">'#vue'</span><span class="token punctuation">,</span>          <span class="token comment">// 微应用挂载到主应用上的容器</span>
    <span class="token literal-property property">activeRule</span><span class="token operator">:</span> <span class="token string">'/vue'</span><span class="token punctuation">,</span>         <span class="token comment">// 微应用激活条件</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
<span class="token comment">// 启动 qiankun</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#base-app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 注意：这里的ID名称 app 改为 base-app</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 基座配置 3: 修改 micro-main/public/index.html --&gt;</span>

<span class="token comment">&lt;!-- 将 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 调整为 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>base-app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 基座配置 4: micro-main/src/App.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>VUE 子应用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 与 基座配置 2 中的「 container: '#vue', 」 保持一致 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vue<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>其他页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- todo --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div> <h4 id="步骤三-初始化「子应用项目」并配置"><a href="#步骤三-初始化「子应用项目」并配置" class="header-anchor">#</a> 步骤三：初始化「子应用项目」并配置</h4> <ul><li>3.1 在 qiankun-project 目录下，运行下面命令</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$ vue create micro<span class="token operator">-</span>vue         <span class="token comment">// 生成一个 子应用项目（VUE 3.x版本）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>3.2 配置「子应用项目」：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子应用项目配置 1: micro-vue/vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> packageName <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">lintOnSave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8081</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">'vueApp'</span><span class="token punctuation">,</span>     <span class="token comment">// 基座配置 2 中的 「 name: 'vueApp', 」</span>
      <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
      <span class="token comment">// jsonpFunction: `webpackJsonp_${packageName}`</span>
      <span class="token comment">// 注意 webpack 5要用下面的方式</span>
      <span class="token literal-property property">chunkLoadingGlobal</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子应用项目配置 2: 新建 micro-vue/src/public-path.js 文件</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// + 后面的内容是有配置 publicPath 的时候需要使用，没有配置可以不用写</span>
  __webpack_public_path__ <span class="token operator">=</span> window<span class="token punctuation">.</span>__INJECTED_PUBLIC_PATH_BY_QIANKUN__ <span class="token operator">+</span> <span class="token string">'vue/'</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子应用项目配置 3: micro-vue/src/main.js</span>
<span class="token keyword">import</span> <span class="token string">'./public-path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token punctuation">;</span>
 
<span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 为了避免根id#app与其他DOM冲突，需要限制查找范围</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
 
<span class="token comment">/**
* bootstrap 只会在微应用初始化的时候调用一次，下次微应用重新进入时会直接调用 mount 钩子，不会再重复触发 bootstrap。
* 通常我们可以在这里做一些全局变量的初始化，比如不会在 unmount 阶段被销毁的应用级别的缓存等。
*/</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react app bootstraped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">/**
* 应用每次进入都会调用 mount 方法，通常我们在这里触发应用的渲染方法
*/</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'props from main mount'</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
 
<span class="token comment">/**
* 应用每次 切出/卸载 会调用的方法，通常在这里我们会卸载微应用的应用实例
*/</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
 
<span class="token comment">/**
* 可选生命周期钩子，仅使用 loadMicroApp 方式加载微应用时生效
*/</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update props'</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 子应用项目配置 4: 修改 micro-vue/src/App.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  我来自子应用
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/assets/img/qiankun_demo.33e27d91.png" alt="An image"></p> <h3 id="四、demo验证"><a href="#四、demo验证" class="header-anchor">#</a> 四、DEMO验证</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1、样式隔离</span>
<span class="token comment">// 2、JS沙箱</span>
<span class="token comment">// 3、预加载</span>
<span class="token comment">// 4、跨域问题</span>
<span class="token comment">// 5、应用间通信</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_1、样式隔离"><a href="#_1、样式隔离" class="header-anchor">#</a> 1、样式隔离</h4> <p>解决方案： 「 postcss-selector-namesapce 」 设置别名 （或者 postcss-prefix-selector 插件）</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 1. 安装 postcss-selector-namespace</span>
$ npm i postcss<span class="token operator">-</span>selector<span class="token operator">-</span>namespace <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// OR</span>
$ yarn add postcss<span class="token operator">-</span>selector<span class="token operator">-</span>namespace <span class="token operator">-</span><span class="token constant">D</span>

<span class="token comment">// 2. 使用 （在子应用项目 里面新建 postcss.config.js， 在项目根目录下）</span>
<span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'postcss-selector-namespace'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">namespace</span><span class="token punctuation">(</span><span class="token parameter">css</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'.vueApp-space'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3. 在 micro-vue/index.html 里面新增「配置的别名 .vueApp-space」</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vueApp-space<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">// 4. 过滤掉不想被添加「别名前缀」的样式文件可以按照下面的方法进行配置</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'postcss-selector-namespace'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">namespace</span><span class="token punctuation">(</span><span class="token parameter">css</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token comment">// 不想被添加「别名前缀」 的样式文件，可以在这里过滤掉</span>
            css<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'demo.scss'</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">''</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> <span class="token string">'.vueapp-space'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 备注：或者使用qiankun自带的样式沙箱隔离方案。</span>
<span class="token comment">// 在「基座项目」配置中调整为以下代码</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">sandbox</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">experimentalStyleIsolation</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// strictStyleIsolation: true       // 严格沙箱</span>
<span class="token comment">// experimentalStyleIsolation: true // 实验性沙箱</span>
<span class="token comment">// 缺点：子应用的弹窗、抽屉、popover因插入到了「基座应用」的body，所以导致样式丢失或应用了「基座应用」的样式</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* 使用qiankun自带的样式沙箱隔离方案会生成如下代码 */</span>
<span class="token selector">div[data-qiankun=&quot;vueApp&quot;] .common-blue</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/assets/img/qiankun_demo2.0e44d341.png" alt="An image"></p> <div class="custom-block warning"><p class="custom-block-title">注意：样式丢失问题</p> <p>子应用的弹窗、抽屉、popover因插入到了「基座应用」的body导致样式丢失或应用了「基座应用」的样式。</p> <p>处理的思路可以从两个点思考：</p> <ol><li>样式内置：行内样式（也称内联样式），或者组件中插入「style」内部样式</li> <li>增加别名前缀：给子应用的弹窗等的最外层DIV增加一个「别名前缀」，和「postcss-selector-namespace」中的配置保持一致</li></ol></div> <details class="custom-block details"><summary>样式内置（相关代码）</summary> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    我来自子应用
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>common-blue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>子应用 use common-blue 的标签<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>common-yellow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>子应用 Modify common-yellow 的标签<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mainBox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showTc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击我显示弹窗<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> mainBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'base-app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">showTc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> popUpBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> htmlCont <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;style&gt;
        .pop-up {
          width: 100%;
          height: 100%;
          position: fixed;
          top: 0;
          left: 0;
          z-index: 99;
          color: #fff;
          text-align: center;
          background: rgba(0, 0, 0, 0.85);
        }
        .pop-up-cont {
          position: absolute;
          width: 200px;
          height: 200px;
          margin: auto;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          border: 1px solid #fff;
          border-radius: 10px;
        }
        .pop-up-tit {
          color: #f00;
        }
        .pop-up-desc {
          color: grey;
        }
      &lt;/style&gt;
      &lt;div class=&quot;pop-up&quot; id=&quot;pop-up-box&quot;&gt;
        &lt;div class=&quot;pop-up-cont&quot;&gt;
          &lt;h3 class=&quot;pop-up-tit&quot;&gt;我是自定义弹窗&lt;/h3&gt;
          &lt;p class=&quot;pop-up-desc&quot;&gt;一些奇奇怪怪的描述&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    popUpBox<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> htmlCont<span class="token punctuation">;</span>
    mainBox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>popUpBox<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div></details> <details class="custom-block details"><summary>增加别名前缀（相关代码）</summary> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    我来自子应用
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>common-blue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>子应用 use common-blue 的标签<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>common-yellow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>子应用 Modify common-yellow 的标签<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mainBox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showTc<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-right</span><span class="token punctuation">:</span>20px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>点击我显示弹窗（样式内置）<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mainBox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showTc2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击我显示弹窗（添加前缀）<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> mainBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'base-app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">showTc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">showTc2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> popUpBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> htmlCont <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;div class=&quot;pop-up&quot; id=&quot;pop-up-box&quot;&gt;
        &lt;div class=&quot;pop-up-cont&quot;&gt;
          &lt;h3 class=&quot;pop-up-tit&quot;&gt;我是自定义弹窗&lt;/h3&gt;
          &lt;p class=&quot;pop-up-desc&quot;&gt;一些奇奇怪怪的描述&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token comment">// 增加别名前缀</span>
    popUpBox<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'vueapp-space'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    popUpBox<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> htmlCont<span class="token punctuation">;</span>
    mainBox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>popUpBox<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>配置 vueapp.scss:</p> <div class="language-scss line-numbers-mode"><pre class="language-scss"><code><span class="token selector">.pop-up </span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 99<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.85<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token selector">.pop-up-cont </span><span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #fff<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.pop-up-tit </span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #f00<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.pop-up-desc </span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> grey<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></details> <p><img src="/assets/img/qiankun_demo3.8a254b52.png" alt="An image"></p> <h4 id="_2、js沙箱"><a href="#_2、js沙箱" class="header-anchor">#</a> 2、JS沙箱</h4> <p>TODO...</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>legacySandBox   <span class="token comment">// 基于 Proxy API 来实现</span>
proxySandBox    <span class="token comment">// 基于 Proxy API 来实现</span>
snapshotSandBox <span class="token comment">// 不支持 Proxy API 的低版本浏览器中，会降级为 snapshotSandBox</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_3、预加载"><a href="#_3、预加载" class="header-anchor">#</a> 3、预加载</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * prefetch - boolean | 'all' | string[] | (( apps: RegistrableApp[] ) =&gt; { criticalAppNames: string[]; minorAppsName: string[] }) - 可选，是否开启预加载，默认为 true。
 * 配置为 true 则会在第一个微应用 mount 完成后开始预加载其他微应用的静态资源
 * 配置为 'all' 则主应用 start 后即开始预加载所有微应用静态资源
 * 配置为 string[] 则会在第一个微应用 mounted 后开始加载数组内的微应用资源
 * 配置为 function 则可完全自定义应用的资源加载时机 (首屏应用及次屏应用)
*/</span>

<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token string">'all'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_4、跨域问题"><a href="#_4、跨域问题" class="header-anchor">#</a> 4、跨域问题</h4> <p>由于 qiankun 是通过 fetch 去获取子应用注册时配置的静态资源url，所有静态资源必须是支持跨域的，那就得设置允许源。</p> <ul><li>Access-Control-Allow-Origin：跨域在服务端是不允许的。只能通过给Nginx配置Access-Control-Allow-Origin *后，才能使服务器能接受所有的请求源（Origin）。</li> <li>Access-Control-Allow-Headers: 设置支持的Content-Type</li></ul> <h4 id="_5、应用间通信"><a href="#_5、应用间通信" class="header-anchor">#</a> 5、应用间通信</h4> <p>qiankun 通过发布订阅模式来实现应用间通信，状态由框架来统一维护，每个应用在初始化时由框架生成一套通信方法，应用通过这些方法来更改全局状态和注册回调函数，全局状态发生改变时触发各个应用注册的回调函数执行，将新旧状态传递到所有应用。</p> <p>initGlobalState</p> <p>TODO...</p> <h4 id="_6、打包部署"><a href="#_6、打包部署" class="header-anchor">#</a> 6、打包部署</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 打包部署基本上是和 Nginx 配置相关</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>DEMO效果查看：<br> <a href="http://demo.ycy88.com/" target="_blank">「qiankun」DEMO - 基座</a><br> <a href="http://demo.ycy88.com/micro-vue" target="_blank">「qiankun」DEMO - 加载子应用项目</a><br></p> <div class="custom-block tip"><p class="custom-block-title">qiankun与single-spa区别</p> <p>乾坤基于single-spa，加强了微应用集成能力，却抛弃了微模块的能力。所以，它们的区别就是微服务的粒度，乾坤的所能服务的粒度是应用级别，而single-spa则是模块级别。它们都能将前端进行拆分，只是拆分的粒度不同罢了。</p> <p>微应用加载器：“微”的粒度是应用，也就是HTML，它只能做到应用级别的分享 <br>
微模块加载器：“微”的粒度是模块，也就是JS模块，它能做到模块级别的分享</p></div> <p>DEMO源码：<a href="https://github.com/bobo88/project-basis/tree/main/qiankun-basis" target="_blank">「qiankun」DEMO源码</a><br></p> <p>参考文章：<br> <a href="https://qiankun.umijs.org/zh" target="_blank">「qiankun」 from 阿里</a><br> <a href="https://tehub.com/a/8xrFr58LyQ" target="_blank">基于qiankun的微前端最佳实践 -（同时加载多个微应用）</a><br> <a href="https://juejin.cn/post/6973156414210441247" target="_blank">Vue+微前端(QianKun)落地实施和最后部署上线总结</a><br></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tools/14_微前端.html" class="prev">
        微前端
      </a></span> <span class="next"><a href="/tools/14_微前端webpack 5 Module Federation.html">
        微前端webpack 5 Module Federation
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.51b826ab.js" defer></script><script src="/assets/js/2.ebacbe49.js" defer></script><script src="/assets/js/5.13e02d4e.js" defer></script>
  </body>
</html>
